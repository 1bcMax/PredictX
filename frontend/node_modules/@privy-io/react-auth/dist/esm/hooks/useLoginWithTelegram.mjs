import{useCallback as t}from"react";import{PrivyErrorCode as e}from"../errors.mjs";import{useCaptcha as r,CaptchaError as o}from"./captcha-context.mjs";import{usePrivyInternal as i}from"./internal-context.mjs";import"ofetch";import"react/jsx-runtime";import"./index.mjs";import"../utils/index.mjs";import"../connectors/get-legacy-injected-providers.mjs";import"../connectors/is-wallet-installed.mjs";import"../utils/eth/getPublicClient.mjs";import"viem";const n=n=>{let s=r(),{initLoginWithTelegram:a,loginWithTelegram:m,telegramAuthState:l,setTelegramAuthState:c}=i();return{login:t((async t=>{try{if(s.enabled&&"success"!==s.status)throw new o(s.error,null,e.CAPTCHA_FAILURE);await a(s.token,t?.disableSignup);let{user:r,isNewUser:i,loginAccount:l,wasAlreadyAuthenticated:c}=await m({intent:"login"});n?.onComplete?.({user:r,isNewUser:i,wasAlreadyAuthenticated:c,loginMethod:"telegram",loginAccount:l})}catch(t){throw c({status:"error",error:t}),n?.onError?.(t.privyErrorCode||e.UNKNOWN_AUTH_ERROR),t}}),[a,m,s]),state:l}};export{n as useLoginWithTelegram};
