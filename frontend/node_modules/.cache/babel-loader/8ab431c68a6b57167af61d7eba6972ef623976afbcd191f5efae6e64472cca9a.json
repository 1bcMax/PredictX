{"ast":null,"code":"import { CrossAppAuthFlow as o } from \"../../auth-flows/cross-app.mjs\";\nimport { PrivyClientError as r, formatApiError as e, PrivyErrorCode as t } from \"../../errors.mjs\";\nimport { oAuthInitPath as i } from \"../../paths.mjs\";\nimport { createCodeVerifier as a, createStateCode as n, deriveCodeChallengeFromCodeVerifier as p } from \"../pkce.mjs\";\nimport \"ofetch\";\nimport \"jose\";\nimport \"../../constants.mjs\";\nimport \"../../crypto.mjs\";\nimport \"../../storage.mjs\";\nasync function s({\n  api: o,\n  requesterAppId: e,\n  providerAppId: t\n}) {\n  let i = (await o.get(`/api/v1/apps/${e}/cross-app/connections`)).connections.find(o => o.provider_app_id === t);\n  if (!i) throw new r(\"Invalid connected app\");\n  return {\n    name: i.provider_app_name,\n    logoUrl: i.provider_app_icon_url || void 0,\n    apiUrl: i.provider_app_custom_api_url,\n    readOnly: i.read_only\n  };\n}\nasync function d({\n  api: o,\n  appId: r\n}) {\n  let t = a(),\n    s = n(),\n    d = await p(t);\n  try {\n    let {\n      url: e\n    } = await o.post(i, {\n      provider: `privy:${r}`,\n      redirect_to: window.location.href,\n      code_challenge: d,\n      state_code: s\n    });\n    return {\n      url: e,\n      stateCode: s,\n      codeVerifier: t\n    };\n  } catch (o) {\n    throw e(o);\n  }\n}\nasync function c({\n  appId: i,\n  stateCode: a,\n  codeVerifier: n,\n  authorizationCode: p,\n  action: s,\n  client: d\n}) {\n  if (!p || !a) throw new r(\"[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.\");\n  if (\"undefined\" === p) throw new r(\"User denied confirmation during cross-app auth flow\");\n  try {\n    let r = new o({\n      authorizationCode: p,\n      stateCode: a,\n      codeVerifier: n,\n      provider: `privy:${i}`\n    });\n    d.startAuthFlow(r);\n    let e = \"link\" === s ? await d.link() : await d.authenticate(),\n      t = e.oAuthTokens?.accessToken;\n    return console.debug(), t;\n  } catch (i) {\n    let o = e(i);\n    if (o.privyErrorCode) throw new r(o.message || \"Invalid code during cross-app auth flow.\", void 0, o.privyErrorCode);\n    if (\"User denied confirmation during cross-app auth flow\" === o.message) throw new r(\"Invalid code during cross-app auth flow.\", void 0, t.OAUTH_USER_DENIED);\n    throw new r(\"Invalid code during cross-app auth flow.\", void 0, t.UNKNOWN_AUTH_ERROR);\n  }\n}\nexport { c as authenticateCrossAppAccount, d as getCrossAppAuthorizationUrl, s as getProviderAppMetadata };","map":{"version":3,"names":["CrossAppAuthFlow","o","PrivyClientError","r","formatApiError","e","PrivyErrorCode","t","oAuthInitPath","i","createCodeVerifier","a","createStateCode","n","deriveCodeChallengeFromCodeVerifier","p","s","api","requesterAppId","providerAppId","get","connections","find","provider_app_id","name","provider_app_name","logoUrl","provider_app_icon_url","apiUrl","provider_app_custom_api_url","readOnly","read_only","d","appId","url","post","provider","redirect_to","window","location","href","code_challenge","state_code","stateCode","codeVerifier","c","authorizationCode","action","client","startAuthFlow","link","authenticate","oAuthTokens","accessToken","console","debug","privyErrorCode","message","OAUTH_USER_DENIED","UNKNOWN_AUTH_ERROR","authenticateCrossAppAccount","getCrossAppAuthorizationUrl","getProviderAppMetadata"],"sources":["/Users/vickyfu/Documents/PredictX/frontend/node_modules/@privy-io/react-auth/dist/esm/lib/cross-app/authFlow.mjs"],"sourcesContent":["import{CrossAppAuthFlow as o}from\"../../auth-flows/cross-app.mjs\";import{PrivyClientError as r,formatApiError as e,PrivyErrorCode as t}from\"../../errors.mjs\";import{oAuthInitPath as i}from\"../../paths.mjs\";import{createCodeVerifier as a,createStateCode as n,deriveCodeChallengeFromCodeVerifier as p}from\"../pkce.mjs\";import\"ofetch\";import\"jose\";import\"../../constants.mjs\";import\"../../crypto.mjs\";import\"../../storage.mjs\";async function s({api:o,requesterAppId:e,providerAppId:t}){let i=(await o.get(`/api/v1/apps/${e}/cross-app/connections`)).connections.find((o=>o.provider_app_id===t));if(!i)throw new r(\"Invalid connected app\");return{name:i.provider_app_name,logoUrl:i.provider_app_icon_url||void 0,apiUrl:i.provider_app_custom_api_url,readOnly:i.read_only}}async function d({api:o,appId:r}){let t=a(),s=n(),d=await p(t);try{let{url:e}=await o.post(i,{provider:`privy:${r}`,redirect_to:window.location.href,code_challenge:d,state_code:s});return{url:e,stateCode:s,codeVerifier:t}}catch(o){throw e(o)}}async function c({appId:i,stateCode:a,codeVerifier:n,authorizationCode:p,action:s,client:d}){if(!p||!a)throw new r(\"[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.\");if(\"undefined\"===p)throw new r(\"User denied confirmation during cross-app auth flow\");try{let r=new o({authorizationCode:p,stateCode:a,codeVerifier:n,provider:`privy:${i}`});d.startAuthFlow(r);let e=\"link\"===s?await d.link():await d.authenticate(),t=e.oAuthTokens?.accessToken;return console.debug(),t}catch(i){let o=e(i);if(o.privyErrorCode)throw new r(o.message||\"Invalid code during cross-app auth flow.\",void 0,o.privyErrorCode);if(\"User denied confirmation during cross-app auth flow\"===o.message)throw new r(\"Invalid code during cross-app auth flow.\",void 0,t.OAUTH_USER_DENIED);throw new r(\"Invalid code during cross-app auth flow.\",void 0,t.UNKNOWN_AUTH_ERROR)}}export{c as authenticateCrossAppAccount,d as getCrossAppAuthorizationUrl,s as getProviderAppMetadata};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}