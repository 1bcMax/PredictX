{"ast":null,"code":"import { RunEffectOnce as e } from \"../effect.mjs\";\nimport { PrivyClientError as t, formatApiError as s } from \"../errors.mjs\";\nimport { prepareSiwsMessageWithNonce as i } from \"../lib/siws.mjs\";\nimport \"ofetch\";\nclass n {\n  get meta() {\n    return {\n      connectorType: this.wallet.connectorType,\n      walletClientType: this.wallet.walletClientType,\n      disableSignup: this._meta.disableSignup\n    };\n  }\n  async authenticate() {\n    if (!this.client) throw new t(\"SiwsFlow has no client instance\");\n    try {\n      let {\n        message: e,\n        signature: t\n      } = await this.sign();\n      return await this.client.authenticateWithSiwsInternal({\n        message: e,\n        signature: t,\n        walletClientType: this.wallet.walletClientType,\n        connectorType: this.wallet.connectorType,\n        mode: this.meta.disableSignup ? \"no-signup\" : \"login-or-sign-up\"\n      });\n    } catch (e) {\n      throw s(e);\n    }\n  }\n  async link() {\n    if (!this.client) throw new t(\"SiwsFlow has no client instance\");\n    try {\n      let {\n        message: e,\n        signature: t\n      } = await this.sign();\n      return await this.client.linkWithSiwsInternal({\n        message: e,\n        signature: t,\n        walletClientType: this.wallet.walletClientType,\n        connectorType: this.wallet.connectorType\n      });\n    } catch (e) {\n      throw s(e);\n    }\n  }\n  async sign() {\n    if (!this.client) throw new t(\"SiwsFlow has no client instance\");\n    if (await this.buildMessage(), !this.preparedMessage) throw new t(\"Could not prepare SIWS message\");\n    if (!this.wallet.signMessage) throw new t(\"Wallet does not support signMessage\");\n    let e = await this.wallet.signMessage(Buffer.from(this.preparedMessage));\n    return {\n      message: this.preparedMessage,\n      signature: Buffer.from(e).toString(\"base64\")\n    };\n  }\n  async _getNonceOnce() {\n    if (!this.client) throw new t(\"SiwsFlow has no client instance\");\n    return await this.client.generateSiwsNonce({\n      address: this.wallet.address,\n      captchaToken: this.captchaToken\n    });\n  }\n  async buildMessage() {\n    if (!this.client) throw new t(\"SiwsFlow has no client instance\");\n    let e = this.wallet.address;\n    return this.nonce || (this.nonce = await this.getNonceOnce.execute()), this.preparedMessage = i({\n      address: e,\n      nonce: this.nonce\n    }), this.preparedMessage;\n  }\n  constructor(t, s, i, n = !1) {\n    this._meta = {\n      disableSignup: !1\n    }, this.getNonceOnce = new e(this._getNonceOnce.bind(this)), this.wallet = t, this.captchaToken = i, this.client = s, this._meta.disableSignup = n;\n  }\n}\nexport { n as SiwsFlow };","map":{"version":3,"names":["RunEffectOnce","e","PrivyClientError","t","formatApiError","s","prepareSiwsMessageWithNonce","i","n","meta","connectorType","wallet","walletClientType","disableSignup","_meta","authenticate","client","message","signature","sign","authenticateWithSiwsInternal","mode","link","linkWithSiwsInternal","buildMessage","preparedMessage","signMessage","Buffer","from","toString","_getNonceOnce","generateSiwsNonce","address","captchaToken","nonce","getNonceOnce","execute","constructor","bind","SiwsFlow"],"sources":["/Users/vickyfu/Documents/PredictX/frontend/node_modules/@privy-io/react-auth/dist/esm/auth-flows/siws.mjs"],"sourcesContent":["import{RunEffectOnce as e}from\"../effect.mjs\";import{PrivyClientError as t,formatApiError as s}from\"../errors.mjs\";import{prepareSiwsMessageWithNonce as i}from\"../lib/siws.mjs\";import\"ofetch\";class n{get meta(){return{connectorType:this.wallet.connectorType,walletClientType:this.wallet.walletClientType,disableSignup:this._meta.disableSignup}}async authenticate(){if(!this.client)throw new t(\"SiwsFlow has no client instance\");try{let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?\"no-signup\":\"login-or-sign-up\"})}catch(e){throw s(e)}}async link(){if(!this.client)throw new t(\"SiwsFlow has no client instance\");try{let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType})}catch(e){throw s(e)}}async sign(){if(!this.client)throw new t(\"SiwsFlow has no client instance\");if(await this.buildMessage(),!this.preparedMessage)throw new t(\"Could not prepare SIWS message\");if(!this.wallet.signMessage)throw new t(\"Wallet does not support signMessage\");let e=await this.wallet.signMessage(Buffer.from(this.preparedMessage));return{message:this.preparedMessage,signature:Buffer.from(e).toString(\"base64\")}}async _getNonceOnce(){if(!this.client)throw new t(\"SiwsFlow has no client instance\");return await this.client.generateSiwsNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new t(\"SiwsFlow has no client instance\");let e=this.wallet.address;return this.nonce||(this.nonce=await this.getNonceOnce.execute()),this.preparedMessage=i({address:e,nonce:this.nonce}),this.preparedMessage}constructor(t,s,i,n=!1){this._meta={disableSignup:!1},this.getNonceOnce=new e(this._getNonceOnce.bind(this)),this.wallet=t,this.captchaToken=i,this.client=s,this._meta.disableSignup=n}}export{n as SiwsFlow};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}