{"ast":null,"code":"import { toHex as e } from \"viem\";\nimport { PrivyClientError as r } from \"../../errors.mjs\";\nimport { triggerPopup as t } from \"../popup/triggerPopup.mjs\";\nimport { getProviderAppMetadata as a } from \"./authFlow.mjs\";\nimport \"ofetch\";\nimport \"../../auth-flows/cross-app.mjs\";\nimport \"../../paths.mjs\";\nimport \"../pkce.mjs\";\nimport \"jose\";\nimport \"../../constants.mjs\";\nimport \"../../crypto.mjs\";\nimport \"../../storage.mjs\";\nconst s = async ({\n  user: e,\n  address: s,\n  client: n,\n  request: i,\n  requesterAppId: d,\n  reconnect: p\n}) => {\n  n.createAnalyticsEvent({\n    eventName: \"cross_app_request_started\",\n    payload: {\n      address: s,\n      method: i.method\n    }\n  });\n  let c = e?.linkedAccounts.find(e => \"cross_app\" === e.type && (e.embeddedWallets.some(e => e.address === s) || e.smartWallets.some(e => e.address === s)));\n  if (!e || !c) throw n.createAnalyticsEvent({\n    eventName: \"cross_app_request_error\",\n    payload: {\n      error: \"Cannot request a signature with this wallet address\",\n      address: s\n    }\n  }), new r(\"Cannot request a signature with this wallet address\");\n  let l = n.getProviderAccessToken(c.providerApp.id),\n    m = await a({\n      api: n.api,\n      requesterAppId: d,\n      providerAppId: c.providerApp.id\n    });\n  if (!l) {\n    if (m.readOnly) throw console.error(\"cannot transact against a read-only provider app\"), new r(\"Cannot transact against a read-only provider app\");\n    (await p({\n      appId: c.providerApp.id,\n      action: \"link\"\n    })) && (l = n.getProviderAccessToken(c.providerApp.id));\n  }\n  if (!l) throw n.createAnalyticsEvent({\n    eventName: \"cross_app_request_error\",\n    payload: {\n      error: \"Transactions require a valid token\",\n      address: s\n    }\n  }), new r(\"Transactions require a valid token\");\n  let u = t();\n  if (!u) throw n.createAnalyticsEvent({\n    eventName: \"cross_app_request_error\",\n    payload: {\n      error: \"Missing token\",\n      address: s\n    }\n  }), new r(\"Failed to initialize signature request\");\n  let v = new URL(`${m.apiUrl}/oauth/transact`);\n  return v.searchParams.set(\"token\", l || \"\"), v.searchParams.set(\"request\", o(i)), u.location = v.href, new Promise((e, t) => {\n    let a = setTimeout(() => {\n        p(), t(new r(\"Request timeout\")), n.createAnalyticsEvent({\n          eventName: \"cross_app_request_error\",\n          payload: {\n            error: \"Request timeout\",\n            address: s\n          }\n        });\n      }, 12e4),\n      o = setInterval(() => {\n        u.closed && (p(), t(new r(\"User rejected request\")), n.createAnalyticsEvent({\n          eventName: \"cross_app_request_error\",\n          payload: {\n            error: \"User rejected request\",\n            address: s\n          }\n        }));\n      }, 300),\n      d = r => {\n        r.data && (\"set\" === r.data.token?.action && void 0 !== r.data.token?.value ? n.storeProviderAccessToken(c.providerApp.id, r.data.token.value) : \"clear\" === r.data.token?.action && n.storeProviderAccessToken(c.providerApp.id, null), \"PRIVY_CROSS_APP_ACTION_RESPONSE\" === r.data.type && r.data.result && (p(), e(r.data.result), n.createAnalyticsEvent({\n          eventName: \"cross_app_request_success\",\n          payload: {\n            address: s,\n            method: i.method\n          }\n        })), \"PRIVY_CROSS_APP_ACTION_ERROR\" === r.data.type && r.data.error && (p(), t(r.data.error), n.createAnalyticsEvent({\n          eventName: \"cross_app_request_error\",\n          payload: {\n            error: r.data.error,\n            address: s\n          }\n        })));\n      };\n    window.addEventListener(\"message\", d);\n    let p = () => {\n      u.close(), clearInterval(o), clearTimeout(a), window.removeEventListener(\"message\", d);\n    };\n  });\n};\nlet o = r => JSON.stringify({\n  content: {\n    request: {\n      request: n(r, e)\n    }\n  },\n  timestamp: Date.now(),\n  callbackUrl: window.origin\n});\nconst n = (e, r) => \"bigint\" == typeof e ? r(e) : Array.isArray(e) ? e.map(e => n(e, r)) : e && \"object\" == typeof e ? Object.fromEntries(Object.entries(e).map(([e, t]) => [e, n(t, r)])) : e;\nexport { n as replaceBigInts, s as sendCrossAppRequest };","map":{"version":3,"names":["toHex","e","PrivyClientError","r","triggerPopup","t","getProviderAppMetadata","a","s","user","address","client","n","request","i","requesterAppId","d","reconnect","p","createAnalyticsEvent","eventName","payload","method","c","linkedAccounts","find","type","embeddedWallets","some","smartWallets","error","l","getProviderAccessToken","providerApp","id","m","api","providerAppId","readOnly","console","appId","action","u","v","URL","apiUrl","searchParams","set","o","location","href","Promise","setTimeout","setInterval","closed","data","token","value","storeProviderAccessToken","result","window","addEventListener","close","clearInterval","clearTimeout","removeEventListener","JSON","stringify","content","timestamp","Date","now","callbackUrl","origin","Array","isArray","map","Object","fromEntries","entries","replaceBigInts","sendCrossAppRequest"],"sources":["/Users/vickyfu/Documents/PredictX/frontend/node_modules/@privy-io/react-auth/dist/esm/lib/cross-app/sendCrossAppRequest.mjs"],"sourcesContent":["import{toHex as e}from\"viem\";import{PrivyClientError as r}from\"../../errors.mjs\";import{triggerPopup as t}from\"../popup/triggerPopup.mjs\";import{getProviderAppMetadata as a}from\"./authFlow.mjs\";import\"ofetch\";import\"../../auth-flows/cross-app.mjs\";import\"../../paths.mjs\";import\"../pkce.mjs\";import\"jose\";import\"../../constants.mjs\";import\"../../crypto.mjs\";import\"../../storage.mjs\";const s=async({user:e,address:s,client:n,request:i,requesterAppId:d,reconnect:p})=>{n.createAnalyticsEvent({eventName:\"cross_app_request_started\",payload:{address:s,method:i.method}});let c=e?.linkedAccounts.find((e=>\"cross_app\"===e.type&&(e.embeddedWallets.some((e=>e.address===s))||e.smartWallets.some((e=>e.address===s)))));if(!e||!c)throw n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:\"Cannot request a signature with this wallet address\",address:s}}),new r(\"Cannot request a signature with this wallet address\");let l=n.getProviderAccessToken(c.providerApp.id),m=await a({api:n.api,requesterAppId:d,providerAppId:c.providerApp.id});if(!l){if(m.readOnly)throw console.error(\"cannot transact against a read-only provider app\"),new r(\"Cannot transact against a read-only provider app\");await p({appId:c.providerApp.id,action:\"link\"})&&(l=n.getProviderAccessToken(c.providerApp.id))}if(!l)throw n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:\"Transactions require a valid token\",address:s}}),new r(\"Transactions require a valid token\");let u=t();if(!u)throw n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:\"Missing token\",address:s}}),new r(\"Failed to initialize signature request\");let v=new URL(`${m.apiUrl}/oauth/transact`);return v.searchParams.set(\"token\",l||\"\"),v.searchParams.set(\"request\",o(i)),u.location=v.href,new Promise(((e,t)=>{let a=setTimeout((()=>{p(),t(new r(\"Request timeout\")),n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:\"Request timeout\",address:s}})}),12e4),o=setInterval((()=>{u.closed&&(p(),t(new r(\"User rejected request\")),n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:\"User rejected request\",address:s}}))}),300),d=r=>{r.data&&(\"set\"===r.data.token?.action&&void 0!==r.data.token?.value?n.storeProviderAccessToken(c.providerApp.id,r.data.token.value):\"clear\"===r.data.token?.action&&n.storeProviderAccessToken(c.providerApp.id,null),\"PRIVY_CROSS_APP_ACTION_RESPONSE\"===r.data.type&&r.data.result&&(p(),e(r.data.result),n.createAnalyticsEvent({eventName:\"cross_app_request_success\",payload:{address:s,method:i.method}})),\"PRIVY_CROSS_APP_ACTION_ERROR\"===r.data.type&&r.data.error&&(p(),t(r.data.error),n.createAnalyticsEvent({eventName:\"cross_app_request_error\",payload:{error:r.data.error,address:s}})))};window.addEventListener(\"message\",d);let p=()=>{u.close(),clearInterval(o),clearTimeout(a),window.removeEventListener(\"message\",d)}}))};let o=r=>JSON.stringify({content:{request:{request:n(r,e)}},timestamp:Date.now(),callbackUrl:window.origin});const n=(e,r)=>\"bigint\"==typeof e?r(e):Array.isArray(e)?e.map((e=>n(e,r))):e&&\"object\"==typeof e?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,n(t,r)]))):e;export{n as replaceBigInts,s as sendCrossAppRequest};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}